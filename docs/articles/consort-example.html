<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>dtrackr - Consort statement example • dtrackr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="dtrackr - Consort statement example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dtrackr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/dtrackr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/consort-example.html">dtrackr - Consort statement example</a></li>
    <li><a class="dropdown-item" href="../articles/dtrackr-options.html">dtrackr - Configuration example</a></li>
    <li><a class="dropdown-item" href="../articles/grouping-and-nesting.html">dtrackr - Grouping, Nesting and Long format data</a></li>
    <li><a class="dropdown-item" href="../articles/joining-pipelines.html">dtrackr - Joining data pipelines</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/terminological/dtrackr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>dtrackr - Consort statement example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/terminological/dtrackr/blob/HEAD/vignettes/consort-example.Rmd" class="external-link"><code>vignettes/consort-example.Rmd</code></a></small>
      <div class="d-none name"><code>consort-example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="consort-statement">CONSORT statement<a class="anchor" aria-label="anchor" href="#consort-statement"></a>
</h2>
<p>CONSORT diagrams are part of the requirements in reporting parallel
group clinical trials or case control designs in observational studies.
They are described in the updated 2010 CONSORT statement <span class="citation">(Schulz, Altman, and Moher 2010)</span>. They clarify
how patients were recruited, selected, randomised and followed up. For
observational studies an equivalent requirement is the STROBE statement
<span class="citation">(von Elm et al. 2008)</span>. There are other
similar requirements for other types of study such as the TRIPOD
statement that are applicable for multivariate models <span class="citation">(Collins et al. 2015)</span>.</p>
<p>For this demonstration we use the <code>cgd</code> data set from the
<code>survival</code> package <span class="citation">(Terry M. Therneau
and Patricia M. Grambsch 2000; Therneau 2022)</span>, which is from a
placebo controlled trial of gamma interferon in Chronic Granulomatous
Disease.</p>
<p>In this example the <code>treatment</code> column contains the
intervention.</p>
<p>For the analysis we are considering only the first observations for
each patient, and our study criteria are as follows:</p>
<ul>
<li>Only patients from US based centres are considered</li>
<li>Patients must not be on steroids at inception.</li>
<li>Patients must be aged between the ages of 5 and 35 inclusive.</li>
</ul>
<p>This can be coded into the <code>dplyr</code> pipeline, with
additional <code>dtrackr</code> functions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Some useful formatting options</span></span>
<span><span class="va">old</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  dtrackr.strata_glue<span class="op">=</span><span class="st">"{tolower(.value)}"</span>,</span>
<span>  dtrackr.strata_sep<span class="op">=</span><span class="st">", "</span>,</span>
<span>  dtrackr.default_message <span class="op">=</span> <span class="st">"{.count} records"</span>,</span>
<span>  dtrackr.default_headline <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">demo_data</span> <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/cgd.html" class="external-link">cgd</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/track.html">track</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">enum</span> <span class="op">==</span> <span class="fl">1</span>, .type<span class="op">=</span><span class="st">"inclusion"</span>, .messages<span class="op">=</span><span class="st">"{.count.out} first observation"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/include_any.html">include_any</a></span><span class="op">(</span></span>
<span>    <span class="va">hos.cat</span> <span class="op">==</span> <span class="st">"US:NIH"</span> <span class="op">~</span> <span class="st">"{.included} NIH patients"</span>,</span>
<span>    <span class="va">hos.cat</span> <span class="op">==</span> <span class="st">"US:other"</span> <span class="op">~</span> <span class="st">"{.included} other US patients"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">treat</span>, .messages<span class="op">=</span><span class="st">"cases versus controls"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/comment.html">comment</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/capture_exclusions.html">capture_exclusions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/exclude_all.html">exclude_all</a></span><span class="op">(</span></span>
<span>    <span class="va">age</span><span class="op">&lt;</span><span class="fl">5</span> <span class="op">~</span> <span class="st">"{.excluded} subjects under 5"</span>,</span>
<span>    <span class="va">age</span><span class="op">&gt;</span><span class="fl">35</span> <span class="op">~</span> <span class="st">"{.excluded} subjects over 35"</span>,</span>
<span>    <span class="va">steroids</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"{.excluded} on steroids at admission"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/comment.html">comment</a></span><span class="op">(</span>.messages <span class="op">=</span> <span class="st">"{.count} after exclusions"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span></span>
<span>    mean_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.2f \u00B1 %1.2f"</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.2f \u00B1 %1.2f"</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"average height: {mean_height}"</span>,</span>
<span>      <span class="st">"average weight: {mean_weight}"</span></span>
<span>    <span class="op">)</span>                    </span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span>.messages <span class="op">=</span> <span class="st">"{.count} in final data set"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># restore to originals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span></code></pre></div>
<p>With a bit of experimentation the flowchart needed for a
STROBE/CONSORT checklist can be generated. One option to output the
flowchart is <code>svg</code> which can then be manually formatted as
required, but for publication ready output <code>pdf</code> is usually
preferred.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/flowchart.html">flowchart</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generated by graphviz version 2.40.1 (20161225.0304)
 --><!-- Title: %0 Pages: 1 --><svg width="404.000pt" height="385.000pt" viewbox="0 0 404.000 385.000" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1.000 1.000) rotate(0) translate(4 381.000)"><title>%0</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-381.2 400.1472,-381.2 400.1472,4 -4,4"></polygon><!-- 11&#45;&gt;13 --><g id="edge2" class="edge"><title>11:s-&gt;13</title>
<path fill="none" stroke="#000000" d="M122.3098,-41.6C122.3098,-41.6 122.3098,-28.5777 122.3098,-28.5777"></path><polygon fill="#000000" stroke="#000000" points="124.0599,-28.5777 122.3098,-23.5777 120.5599,-28.5778 124.0599,-28.5777"></polygon></g><!-- 12&#45;&gt;13 --><g id="edge1" class="edge"><title>12:s-&gt;13</title>
<path fill="none" stroke="#000000" d="M191.0742,-41.6C191.0742,-41.6 191.0742,-28.5777 191.0742,-28.5777"></path><polygon fill="#000000" stroke="#000000" points="192.8243,-28.5777 191.0742,-23.5777 189.3243,-28.5778 192.8243,-28.5777"></polygon></g><!-- 9&#45;&gt;11 --><g id="edge4" class="edge"><title>9:s-&gt;11</title>
<path fill="none" stroke="#000000" d="M63.692,-97.6C63.692,-97.6 63.692,-84.9669 63.692,-84.9669"></path><polygon fill="#000000" stroke="#000000" points="65.4421,-84.9669 63.692,-79.9669 61.9421,-84.9669 65.4421,-84.9669"></polygon></g><!-- 10&#45;&gt;12 --><g id="edge3" class="edge"><title>10:s-&gt;12</title>
<path fill="none" stroke="#000000" d="M249.692,-97.6C249.692,-97.6 249.692,-84.9669 249.692,-84.9669"></path><polygon fill="#000000" stroke="#000000" points="251.4421,-84.9669 249.692,-79.9669 247.9421,-84.9669 251.4421,-84.9669"></polygon></g><!-- 5&#45;&gt;9 --><g id="edge6" class="edge"><title>5:s-&gt;9</title>
<path fill="none" stroke="#000000" d="M63.692,-153.6C63.692,-153.6 63.692,-132.8669 63.692,-132.8669"></path><polygon fill="#000000" stroke="#000000" points="65.4421,-132.8669 63.692,-127.8669 61.9421,-132.8669 65.4421,-132.8669"></polygon></g><!-- 5&#45;&gt;7 --><g id="edge8" class="edge"><title>5:e-&gt;7</title>
<path fill="none" stroke="#000000" d="M89.692,-168C89.692,-168 98.2504,-168 98.2504,-168"></path><polygon fill="#000000" stroke="#000000" points="98.2505,-169.7501 103.2504,-168 98.2504,-166.2501 98.2505,-169.7501"></polygon></g><!-- 6&#45;&gt;10 --><g id="edge5" class="edge"><title>6:s-&gt;10</title>
<path fill="none" stroke="#000000" d="M249.692,-153.6C249.692,-153.6 249.692,-132.8669 249.692,-132.8669"></path><polygon fill="#000000" stroke="#000000" points="251.4421,-132.8669 249.692,-127.8669 247.9421,-132.8669 251.4421,-132.8669"></polygon></g><!-- 6&#45;&gt;8 --><g id="edge7" class="edge"><title>6:e-&gt;8</title>
<path fill="none" stroke="#000000" d="M275.692,-168C275.692,-168 284.2504,-168 284.2504,-168"></path><polygon fill="#000000" stroke="#000000" points="284.2505,-169.7501 289.2504,-168 284.2504,-166.2501 284.2505,-169.7501"></polygon></g><!-- 4&#45;&gt;5 --><g id="edge10" class="edge"><title>4:s-&gt;5</title>
<path fill="none" stroke="#000000" d="M156.692,-221C156.692,-221 63.692,-221 63.692,-221 63.692,-221 63.692,-188.7563 63.692,-188.7563"></path><polygon fill="#000000" stroke="#000000" points="65.4421,-188.7562 63.692,-183.7563 61.9421,-188.7563 65.4421,-188.7562"></polygon></g><!-- 4&#45;&gt;6 --><g id="edge9" class="edge"><title>4:s-&gt;6</title>
<path fill="none" stroke="#000000" d="M156.692,-221C156.692,-221 249.692,-221 249.692,-221 249.692,-221 249.692,-188.7563 249.692,-188.7563"></path><polygon fill="#000000" stroke="#000000" points="251.4421,-188.7562 249.692,-183.7563 247.9421,-188.7563 251.4421,-188.7562"></polygon></g><!-- 3&#45;&gt;4 --><g id="edge11" class="edge"><title>3:s-&gt;4</title>
<path fill="none" stroke="#000000" d="M156.692,-251.6C156.692,-251.6 156.692,-238.3358 156.692,-238.3358"></path><polygon fill="#000000" stroke="#000000" points="158.4421,-238.3358 156.692,-233.3358 154.9421,-238.3359 158.4421,-238.3358"></polygon></g><!-- 2&#45;&gt;3 --><g id="edge12" class="edge"><title>2:s-&gt;3</title>
<path fill="none" stroke="#000000" d="M156.692,-311.8C156.692,-311.8 156.692,-299.0351 156.692,-299.0351"></path><polygon fill="#000000" stroke="#000000" points="158.4421,-299.0351 156.692,-294.0351 154.9421,-299.0351 158.4421,-299.0351"></polygon></g><!-- 1&#45;&gt;2 --><g id="edge13" class="edge"><title>1:s-&gt;2</title>
<path fill="none" stroke="#000000" d="M156.692,-353.4C156.692,-353.4 156.692,-340.4987 156.692,-340.4987"></path><polygon fill="#000000" stroke="#000000" points="158.4421,-340.4987 156.692,-335.4987 154.9421,-340.4987 158.4421,-340.4987"></polygon></g><!-- 13 --><g id="node1" class="node"><title>13</title>
<polygon fill="#ffffff" stroke="#000000" points="196.1048,-23.4033 117.2792,-23.4033 117.2792,-.1967 196.1048,-.1967 196.1048,-23.4033"></polygon><text text-anchor="start" x="124.2356" y="-9.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">74 in final data set</text></g><!-- 11 --><g id="node2" class="node"><title>11</title>
<polygon fill="#ffffff" stroke="#000000" points="127.5766,-79.6 -.1926,-79.6 -.1926,-41.6 127.5766,-41.6 127.5766,-79.6"></polygon><text text-anchor="start" x="7" y="-66.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">placebo</text><text text-anchor="start" x="7" y="-58.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">average height: 145.58 ± 29.10</text><text text-anchor="start" x="7" y="-50.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">average weight: 45.46 ± 23.20</text></g><!-- 12 --><g id="node3" class="node"><title>12</title>
<polygon fill="#ffffff" stroke="#000000" points="313.5766,-79.6 185.8074,-79.6 185.8074,-41.6 313.5766,-41.6 313.5766,-79.6"></polygon><text text-anchor="start" x="193" y="-66.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">rifn-g</text><text text-anchor="start" x="193" y="-58.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">average height: 143.14 ± 25.12</text><text text-anchor="start" x="193" y="-50.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">average weight: 40.70 ± 20.19</text></g><!-- 9 --><g id="node4" class="node"><title>9</title>
<polygon fill="#ffffff" stroke="#000000" points="103.8766,-127.6 23.5074,-127.6 23.5074,-97.6 103.8766,-97.6 103.8766,-127.6"></polygon><text text-anchor="start" x="30.35" y="-114.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">placebo</text><text text-anchor="start" x="30.35" y="-106.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">36 after exclusions</text></g><!-- 10 --><g id="node5" class="node"><title>10</title>
<polygon fill="#ffffff" stroke="#000000" points="289.8766,-127.6 209.5074,-127.6 209.5074,-97.6 289.8766,-97.6 289.8766,-127.6"></polygon><text text-anchor="start" x="216.35" y="-114.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">rifn-g</text><text text-anchor="start" x="216.35" y="-106.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">38 after exclusions</text></g><!-- 5 --><g id="node6" class="node"><title>5</title>
<polygon fill="#ffffff" stroke="#000000" points="89.478,-183.6 37.906,-183.6 37.906,-153.6 89.478,-153.6 89.478,-183.6"></polygon><text text-anchor="start" x="44.7992" y="-170.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">placebo</text><text text-anchor="start" x="44.7992" y="-162.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">43 records</text></g><!-- 6 --><g id="node7" class="node"><title>6</title>
<polygon fill="#ffffff" stroke="#000000" points="275.478,-183.6 223.906,-183.6 223.906,-153.6 275.478,-153.6 275.478,-183.6"></polygon><text text-anchor="start" x="230.7992" y="-170.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">rifn-g</text><text text-anchor="start" x="230.7992" y="-162.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">46 records</text></g><!-- 7 --><g id="node8" class="node"><title>7</title>
<polygon fill="#cccccc" stroke="#000000" points="210.1024,-191.6 103.2816,-191.6 103.2816,-145.6 210.1024,-145.6 210.1024,-191.6"></polygon><text text-anchor="start" x="110.2368" y="-178.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">placebo</text><text text-anchor="start" x="110.2368" y="-170.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">7 subjects under 5</text><text text-anchor="start" x="110.2368" y="-162.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">0 subjects over 35</text><text text-anchor="start" x="110.2368" y="-154.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">0 on steroids at admission</text></g><!-- 8 --><g id="node9" class="node"><title>8</title>
<polygon fill="#cccccc" stroke="#000000" points="396.1024,-191.6 289.2816,-191.6 289.2816,-145.6 396.1024,-145.6 396.1024,-191.6"></polygon><text text-anchor="start" x="296.2368" y="-178.4" font-family="Helvetica,sans-Serif" font-weight="bold" font-size="8.00" fill="#000000">rifn-g</text><text text-anchor="start" x="296.2368" y="-170.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">4 subjects under 5</text><text text-anchor="start" x="296.2368" y="-162.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">3 subjects over 35</text><text text-anchor="start" x="296.2368" y="-154.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">1 on steroids at admission</text></g><!-- 4 --><g id="node10" class="node"><title>4</title>
<polygon fill="#ffffff" stroke="#000000" points="202.0937,-233.0033 111.2903,-233.0033 111.2903,-209.7967 202.0937,-209.7967 202.0937,-233.0033"></polygon><text text-anchor="start" x="118.2412" y="-219" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">cases versus controls</text></g><!-- 3 --><g id="node11" class="node"><title>3</title>
<polygon fill="#ffffff" stroke="#000000" points="200.1048,-293.9005 113.2792,-293.9005 113.2792,-251.2995 200.1048,-251.2995 200.1048,-293.9005"></polygon><text text-anchor="start" x="120.2356" y="-279.8" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">inclusions:</text><text text-anchor="start" x="120.2356" y="-270.2" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">26 NIH patients</text><text text-anchor="start" x="120.2356" y="-260.6" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">63 other US patients</text></g><!-- 2 --><g id="node12" class="node"><title>2</title>
<polygon fill="#ffffff" stroke="#000000" points="199.7096,-335.4033 113.6744,-335.4033 113.6744,-312.1967 199.7096,-312.1967 199.7096,-335.4033"></polygon><text text-anchor="start" x="120.6832" y="-321.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">128 first observation</text></g><!-- 1 --><g id="node13" class="node"><title>1</title>
<polygon fill="#ffffff" stroke="#000000" points="184.9253,-377.0033 128.4587,-377.0033 128.4587,-353.7967 184.9253,-353.7967 184.9253,-377.0033"></polygon><text text-anchor="start" x="135.5756" y="-363" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">203 records</text></g></g></svg>
</div>
<div class="section level2">
<h2 id="excluded-data">Excluded data<a class="anchor" aria-label="anchor" href="#excluded-data"></a>
</h2>
<p>During this pipeline, we may be keen to understand why certain data
items are being rejected. This would enable us to examine the source
data, and potentially correct it during the data collection process.
We’ve used it to allow continuous quality checks on the data to feed
back to the data curators, as we regularly conduct analyses. By tracking
the exclusions, not only do we track the data flow through the pipeline
we also retain all excluded items, with the reason for exclusion. Thus
we can reassure ourselves that the exclusions are as expected. We
enabled this by calling <code><a href="../reference/capture_exclusions.html">capture_exclusions()</a></code> in the
pipeline above. Having tracked the exclusions we can retrieve them by
calling <code><a href="../reference/excluded.html">excluded()</a></code> which gives a data frame with the
excluded records and the reasons. If the exclusions happened over
multiple stages as the dataframe format change in between then this will
be held as a nested dataframe (i.e. see <code><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">?tidyr::nest</a></code>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># here we filter out the majority of the actual content of the excluded data to focus on the </span></span>
<span><span class="co"># metadata recovered during the exclusion.</span></span>
<span><span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/excluded.html">excluded</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.stage</span>,<span class="va">.message</span>,<span class="va">.filter</span>,<span class="va">age</span>, <span class="va">steroids</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 5</span></span></span>
<span><span class="co">#&gt;    .stage  .message                   .filter       age   steroids</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> stage 1 7 subjects under 5         age &lt; 5       2     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> stage 1 7 subjects under 5         age &lt; 5       1     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> stage 1 7 subjects under 5         age &lt; 5       1     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> stage 1 7 subjects under 5         age &lt; 5       1     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> stage 1 7 subjects under 5         age &lt; 5       1     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> stage 1 7 subjects under 5         age &lt; 5       4     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> stage 1 7 subjects under 5         age &lt; 5       3     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> stage 1 4 subjects under 5         age &lt; 5       3     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> stage 1 4 subjects under 5         age &lt; 5       4     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> stage 1 4 subjects under 5         age &lt; 5       1     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> stage 1 4 subjects under 5         age &lt; 5       4     0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> stage 1 3 subjects over 35         age &gt; 35      44    0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> stage 1 3 subjects over 35         age &gt; 35      38    0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> stage 1 3 subjects over 35         age &gt; 35      37    0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> stage 1 1 on steroids at admission steroids == 1 6     1</span></span></code></pre></div>
<p>This list may have multiple entries for a single data item, if for
example something is excluded in any one step for many reasons.</p>
</div>
<div class="section level2">
<h2 id="tagging-the-pipeline">Tagging the pipeline<a class="anchor" aria-label="anchor" href="#tagging-the-pipeline"></a>
</h2>
<p>For reporting results it is useful to have the numbers from the
flowchart to embed into the text of the results section of the write up.
Here we show the same pipeline as above, but with 4 uses of the
<code>.tag</code> system for labelling part of the pipeline. This
captures data in a tag-value list during the pipeline, and retains it as
metadata for later reuse.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">demo_data</span> <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/cgd.html" class="external-link">cgd</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/track.html">track</a></span><span class="op">(</span>.messages <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">enum</span> <span class="op">==</span> <span class="fl">1</span>, .type<span class="op">=</span><span class="st">"inclusion"</span>, .messages<span class="op">=</span><span class="st">"{.count.out} first observation"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/comment.html">comment</a></span><span class="op">(</span>.tag <span class="op">=</span> <span class="st">"initial cohort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#         ^^^^^^^^^^^^^^^^^^^^^</span></span>
<span>  <span class="co">#         TAGS DEFINED</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/include_any.html">include_any</a></span><span class="op">(</span></span>
<span>    <span class="va">hos.cat</span> <span class="op">==</span> <span class="st">"US:NIH"</span> <span class="op">~</span> <span class="st">"{.included} NIH patients"</span>,</span>
<span>    <span class="va">hos.cat</span> <span class="op">==</span> <span class="st">"US:other"</span> <span class="op">~</span> <span class="st">"{.included} other US patients"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">treat</span>, .messages<span class="op">=</span><span class="st">"cases versus controls"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/comment.html">comment</a></span><span class="op">(</span>.tag<span class="op">=</span><span class="st">"study cohort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#       ^^^^^^^^^^^^^^^^^^^</span></span>
<span>  <span class="co">#       SECOND SET OF TAGS DEFINED</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/capture_exclusions.html">capture_exclusions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/exclude_all.html">exclude_all</a></span><span class="op">(</span></span>
<span>    <span class="va">age</span><span class="op">&lt;</span><span class="fl">5</span> <span class="op">~</span> <span class="st">"{.excluded} subjects under 5"</span>,</span>
<span>    <span class="va">age</span><span class="op">&gt;</span><span class="fl">35</span> <span class="op">~</span> <span class="st">"{.excluded} subjects over 35"</span>,</span>
<span>    <span class="va">steroids</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"{.excluded} on steroids at admission"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/comment.html">comment</a></span><span class="op">(</span>.messages <span class="op">=</span> <span class="st">"{.count} after exclusions"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/status.html">status</a></span><span class="op">(</span></span>
<span>    mean_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.2f \u00B1 %1.2f"</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    mean_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%1.2f \u00B1 %1.2f"</span>,<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .messages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"average height: {mean_height}"</span>,</span>
<span>      <span class="st">"average weight: {mean_weight}"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .tag <span class="op">=</span> <span class="st">"qualifying patients"</span></span>
<span>  <span class="co">#  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span>  <span class="co">#  THIRD SET TAGS DEFINED                    </span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span>.messages <span class="op">=</span> <span class="st">"{.count} in final data set"</span>, .tag<span class="op">=</span><span class="st">"final set"</span><span class="op">)</span></span>
<span>  <span class="co">#                                                 ^^^^^^^^^^^^^^^^</span></span>
<span>  <span class="co">#                                                 LAST TAGS DEFINED</span></span></code></pre></div>
<p>The tagged data can be retrieved as follows, which will give you all
tagged data for all 4 points in the pipeline:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tagged.html">tagged</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">.content</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   .tag                .count .total .strata   treat   mean_height    mean_weight</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> initial cohort         128    128 <span style="color: #949494;">""</span>        <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> study cohort            43     89 <span style="color: #949494;">"</span>placebo<span style="color: #949494;">"</span> placebo <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> study cohort            46     89 <span style="color: #949494;">"</span>rIFN-g<span style="color: #949494;">"</span>  rIFN-g  <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> qualifying patients     36     74 <span style="color: #949494;">"</span>placebo<span style="color: #949494;">"</span> placebo 145.58 ± 29.10 45.46 ± 23…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> qualifying patients     38     74 <span style="color: #949494;">"</span>rIFN-g<span style="color: #949494;">"</span>  rIFN-g  143.14 ± 25.12 40.70 ± 20…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> final set               74     74 <span style="color: #949494;">""</span>        <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>More often though you will want to retrieve specific values from
specific points for the results text for example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialSet</span> <span class="op">=</span> <span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tagged.html">tagged</a></span><span class="op">(</span>.tag <span class="op">=</span> <span class="st">"initial cohort"</span>, .glue <span class="op">=</span> <span class="st">"{.count} patients"</span><span class="op">)</span></span>
<span><span class="va">finalSet</span> <span class="op">=</span> <span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tagged.html">tagged</a></span><span class="op">(</span>.tag <span class="op">=</span> <span class="st">"final set"</span>, .glue <span class="op">=</span> <span class="st">"{.count} patients"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># there were `r initialSet` in the study, of whom `r finalSet` met the eligibility criteria.</span></span></code></pre></div>
<p>For example there were 128 patients in the study, of whom 74 patients
met the eligibility criteria.</p>
<p>More complex formatting and calculations are made possible by use of
the <code>glue</code> specification, including those that happen on a
per group basis, and we can also pull in values from elsewhere in our
analysis.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tagged.html">tagged</a></span><span class="op">(</span></span>
<span>    .tag <span class="op">=</span> <span class="st">"qualifying patients"</span>, </span>
<span>    .glue <span class="op">=</span> <span class="st">"{.strata}: {.count}/{.total} ({sprintf('%1.1f', .count/.total*100)}%) patients on {sysDate}, with a mean height of {mean_height}"</span>, </span>
<span>    sysDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co"># we could have included any number of other parameters here from the global environment</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">.label</span><span class="op">)</span></span>
<span><span class="co">#&gt; placebo: 36/74 (48.6%) patients on 2025-08-29, with a mean height of 145.58 ± 29.10</span></span>
<span><span class="co">#&gt; rIFN-g: 38/74 (51.4%) patients on 2025-08-29, with a mean height of 143.14 ± 25.12</span></span></code></pre></div>
<p>Sometimes it will be necessary to operate on all tagged content at
once. This is possible but be aware that the content available depends
somewhat on where the tag was set in the pipeline so not all fields will
always be present (although <code>.count</code> and <code>.total</code>
will be). The <code>.total</code> is the overall number of cases at that
point in the pipeline. <code>.count</code> is the number of cases in
each strata.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tagged.html">tagged</a></span><span class="op">(</span>.glue <span class="op">=</span> <span class="st">"{.count}/{.total} patients"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   .tag                .strata   .label          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> initial cohort      <span style="color: #949494;">""</span>        128/128 patients</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> study cohort        <span style="color: #949494;">"</span>placebo<span style="color: #949494;">"</span> 43/89 patients  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> study cohort        <span style="color: #949494;">"</span>rIFN-g<span style="color: #949494;">"</span>  46/89 patients  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> qualifying patients <span style="color: #949494;">"</span>placebo<span style="color: #949494;">"</span> 36/74 patients  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> qualifying patients <span style="color: #949494;">"</span>rIFN-g<span style="color: #949494;">"</span>  38/74 patients  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> final set           <span style="color: #949494;">""</span>        74/74 patients</span></span></code></pre></div>
<p>For comparing inclusions and exclusions at different stages in the
pipeline using tags the following example may be useful:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tagged.html">tagged</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>   <span class="co"># selects only top level content</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">.content</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.tag</span>, <span class="va">.total</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>values_from<span class="op">=</span><span class="va">.total</span>, names_from<span class="op">=</span><span class="va">.tag</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data</a></span><span class="op">(</span><span class="st">"Out of {`initial cohort`} patients, {`study cohort`} were eligible for inclusion on the basis of their age</span></span>
<span><span class="st">  but {`study cohort`-`qualifying patients`} were outside the age limits. </span></span>
<span><span class="st">  This left {`final set`} patients included in the final study (i.e. overall {`initial cohort`-`final set`} were removed)."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Out of 128 patients, 89 were eligible for inclusion on the basis of their age</span></span>
<span><span class="co">#&gt; but 15 were outside the age limits. </span></span>
<span><span class="co">#&gt; This left 74 patients included in the final study (i.e. overall 54 were removed).</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reusable-functions">Reusable functions<a class="anchor" aria-label="anchor" href="#reusable-functions"></a>
</h2>
<p>Composing <code>dtrackr</code> inclusion and exclusion criteria into
functions lets you reuse them across different studies, but to be useful
these functions need to be parametrised. As <code>dtrackr</code> uses
formulae to specify the inclusion and exclusion criteria, to construct
an appropriate formulae for <code>dtrackr</code> using values that are
parametrised from a helper function requires injection support, using
<code><a href="https://rlang.r-lib.org/reference/inject.html" class="external-link">rlang::inject()</a></code>. This is an advanced R topic but the
following example gives a sense of what is possible.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># This is a reusable function to restrict ages</span></span>
<span><span class="va">age_restrict</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">age_col</span>, <span class="va">min_age</span> <span class="op">=</span> <span class="fl">18</span>, <span class="va">max_age</span> <span class="op">=</span> <span class="fl">65</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">age_col</span> <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">ensym</a></span><span class="op">(</span><span class="va">age_col</span><span class="op">)</span></span>
<span>  <span class="va">message</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"{.included} between\n%d and %d years"</span>, <span class="va">min_age</span>, <span class="va">max_age</span><span class="op">)</span></span>
<span>  <span class="fu">dtrackr</span><span class="fu">::</span><span class="fu"><a href="../reference/include_any.html">include_any</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>    <span class="co"># injection support for parameters must be made explicit using</span></span>
<span>    <span class="co"># rlang::inject in any functions using include_any or exclude_all</span></span>
<span>    <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/inject.html" class="external-link">inject</a></span><span class="op">(</span><span class="va">min_age</span> <span class="op">&lt;=</span> <span class="op">!</span><span class="op">!</span><span class="va">age_col</span> <span class="op">&amp;</span> <span class="va">max_age</span> <span class="op">&gt;=</span> <span class="op">!</span><span class="op">!</span><span class="va">age_col</span> <span class="op">~</span> <span class="op">!</span><span class="op">!</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/cgd.html" class="external-link">cgd</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># the `age` column is in the cgd dataset: </span></span>
<span>  <span class="fu">age_restrict</span><span class="op">(</span><span class="va">age</span>, max_age <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># demonstrating that this works in 2 stages</span></span>
<span>  <span class="fu">age_restrict</span><span class="op">(</span><span class="va">age</span>, min_age <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/flowchart.html">flowchart</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generated by graphviz version 2.40.1 (20161225.0304)
 --><!-- Title: %0 Pages: 1 --><svg width="79.000pt" height="112.000pt" viewbox="0 0 79.000 112.000" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1.000 1.000) rotate(0) translate(4 108.000)"><title>%0</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-107.6 75.3576,-107.6 75.3576,4 -4,4"></polygon><!-- 1&#45;&gt;2 --><g id="edge1" class="edge"><title>1:s-&gt;2</title>
<path fill="none" stroke="#000000" d="M35.6788,-61.2C35.6788,-61.2 35.6788,-48.1632 35.6788,-48.1632"></path><polygon fill="#000000" stroke="#000000" points="37.4289,-48.1632 35.6788,-43.1632 33.9289,-48.1632 37.4289,-48.1632"></polygon></g><!-- 2 --><g id="node1" class="node"><title>2</title>
<polygon fill="#ffffff" stroke="#000000" points="71.5373,-42.7005 -.1797,-42.7005 -.1797,-.0995 71.5373,-.0995 71.5373,-42.7005"></polygon><text text-anchor="start" x="7" y="-28.6" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">inclusions:</text><text text-anchor="start" x="7" y="-19" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">43 between</text><text text-anchor="start" x="7" y="-9.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">20 and 65 years</text></g><!-- 1 --><g id="node2" class="node"><title>1</title>
<polygon fill="#ffffff" stroke="#000000" points="71.5373,-103.5005 -.1797,-103.5005 -.1797,-60.8995 71.5373,-60.8995 71.5373,-103.5005"></polygon><text text-anchor="start" x="7" y="-89.4" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">inclusions:</text><text text-anchor="start" x="7" y="-79.8" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">52 between</text><text text-anchor="start" x="7" y="-70.2" font-family="Helvetica,sans-Serif" font-size="8.00" fill="#000000">18 and 30 years</text></g></g></svg>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-collinsTransparentReportingMultivariable2015" class="csl-entry">
Collins, Gary S., Johannes B. Reitsma, Douglas G. Altman, and Karel GM
Moons. 2015. <span>“Transparent Reporting of a Multivariable Prediction
Model for Individual Prognosis or Diagnosis (<span>TRIPOD</span>): The
<span>TRIPOD Statement</span>.”</span> <em>BMC Medicine</em> 13 (1): 1.
<a href="https://doi.org/10.1186/s12916-014-0241-z" class="external-link">https://doi.org/10.1186/s12916-014-0241-z</a>.
</div>
<div id="ref-vonelmStrengtheningReportingObservational2008" class="csl-entry">
Elm, Erik von, Douglas G Altman, Matthias Egger, Stuart J Pocock, Peter
C Gøtzsche, Jan P Vandenbroucke, and STROBE Initiative. 2008. <span>“The
<span>Strengthening</span> the <span>Reporting</span> of
<span>Observational Studies</span> in <span>Epidemiology</span>
(<span>STROBE</span>) Statement: Guidelines for Reporting Observational
Studies.”</span> <em>Journal of Clinical Epidemiology</em> 61 (4):
344–49.
</div>
<div id="ref-schulzCONSORT2010Statement2010" class="csl-entry">
Schulz, Kenneth F., Douglas G. Altman, and David Moher. 2010.
<span>“<span>CONSORT</span> 2010 <span>Statement</span>: Updated
Guidelines for Reporting Parallel Group Randomised Trials.”</span>
<em>BMJ</em> 340 (March): c332. <a href="https://doi.org/10.1136/bmj.c332" class="external-link">https://doi.org/10.1136/bmj.c332</a>.
</div>
<div id="ref-survival-book" class="csl-entry">
Terry M. Therneau, and Patricia M. Grambsch. 2000. <em>Modeling Survival
Data: Extending the <span>C</span>ox Model</em>. New York: Springer.
</div>
<div id="ref-survival-package" class="csl-entry">
Therneau, Terry M. 2022. <em>A Package for Survival Analysis in r</em>.
<a href="https://CRAN.R-project.org/package=survival" class="external-link">https://CRAN.R-project.org/package=survival</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
